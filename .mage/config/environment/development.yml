#development
deployment:
    user: example
    from: ./
    to: /home/example/public_html/development
    excludes:
        - .idea
        - .mage
        - ._*
        - .DS_Store
        - .gitignore
        - phpunit.*
        - bootstrap.php
        - ^app/config/parameters.yml
        - ^assets
        - ^files
        - ^node_modules
        - ^system/logs
        - ^system/modules
        - ^system/themes
        - ^tests
        - ^var/cache
        - ^var/logs
        - ^vendor
        - ^web/assets
        - ^web/bundles
        - ^web/files
        - ^web/share
        - ^web/system
        - ^web/app.php

releases:
    enabled: true
    symlink: current
    directory: releases

hosts:
    - example.com

tasks:
    pre-deploy:
        - gulp
        - unit-tests
    on-deploy:
        - filesystem/link-shared-files:
            linked_files:
                - app/config/parameters.yml: relative
            linked_folders:
                - var/logs: relative
                - files: relative
        - composer-self-update
        - composer/install
        - symfony2/cache-clear: {optional: "--no-optional-warmers"} # will not build the internal cache
        - symfony2/assets-install: {env: dev, symlink: true, relative: true}
        - contao-install
        - dev-controller
        - maintenance-lock
    post-release:
        - doctrine-migrate
        - doctrine-clear
        - symfony2/cache-clear: {optional: "--no-optional-warmers"} # will not build the internal cache
        - maintenance-unlock
    post-deploy:
        - clean-releases: {max: 5}
